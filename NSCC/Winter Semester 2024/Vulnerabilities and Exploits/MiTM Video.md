




# The "Attacking RDP with SETH" MiTM Attack




This involves placing a *Kali Machine* between the Server and the Victim






## RDP Authentication Levels :



1. When using network level authentication, the server will reach out to the Domain Controller to check if they are allowed to authenticate/login. This is the highest level of authentication you can give
2. SSL/TLS : Requires an encryption key pair for asymmetric encryption. You would see it when accessing your bank page for example. It has a Certificate downloaded to the Certificate Store, which includes the Google Public Key inside. It is very secure. SSL encryption can be cracked with *John the Ripper* for example. There is a caveat : 
   
	   You need a strong password


You get the public key from the server you are trying to log in to, and it arrives in the form of a certificate, which is downloaded to the certificate store. If that happens, the certificate (encryption key) has to be signed, and it is signed to say " This is the legitimate server you are trying to access with your app". There are two methods of signing: 

1. You can purchase the signing from an Agency such as RSA, which can verify the server (signed by third party, which is paid). 

2. Self-Signed Certificates : a lot of companies do this. You use your own private key to sign the certificate. In case of a third party, RSA would sign the key to say it is legitimate. if you contact a site using self signed  certificates, we would get a warning that we can not verify if the certificate is authentinc. In Ron's last company, every pc on the network had to have a certificate. The first time the client contacts the server, then they run into the warning. If you hit proceed you do not see the warning again. What this means " No one can verify if this is the real page". All organizations use them because they do not want to pay RSA. If you are MITMing an entity, see if they are using a self-signed certificate, as it makes your life easier. Most people using self signed certificates hit proceed any way :). If you are trying to set up an environment for RDP on Windows Server, the Windows server will give  you a certificate to log in there. The public key for the server would be included. You would assume that this Windows certificate is unique to each instance, but it was discovered years ago that every windows install using SSL uses the exact same certificate (which m,eans you can pretend to be the Windows Server, and you would appear as a Windows Server). Microsoft then after the discovery shared the original signing certificate for everyone

3. Native RDP Encryption : :weaker than SSL, but a lot like SSL. When MITMing using RDP, we want to get them away from using "Network Level Authentication", which would verify our access ( we do NOT want that). There is a negotiation phase where they decide on the level of authentication to use. CLIENT ASKS FOR NETWORK LEVEL AUTHEWNTICATION first!. When setting up RDP on a server, there is a checkbox to enable Network level authentication . It wants network level authentication first. What if the server would like network level authentication, but cannot access the Domain Controller? if that happens, every windows instance will send you the same BITSTRING back, which says "Sorry I cannot access the domain controller". THIS MESSAGE can be delivered to the victim, and the client goes down one level of authentication. If doing SSL, and we send a certificate and a phony public key, and we decide to not read it, it goes to native RDP authentication. 

>[!note]
>## Downgrading Authentication Type : 
> 
> #### Downgrading attack: 
> 
> 	We are convincing the client we are the server, trying to reduce  the client's level of authentication to do the hack. You can still try to crack the password.  


### Three things people get wrong : 


In this attack, we are going after a specific IP address. When the *Netmask* is .255, it covers the whole subnet. You should give it the lowest metric, as it would create the shortest route. When the metric goes to the Routing Table, and based on the speed of the network (10 100 network : 25) If you give it a metric of 10, you would see a metric of 25 in the routing table. Put 1111s in all of the octets to the mask. 


Make sure with IP forwarding, you would set it up by echoing a value of 1 when booting the machine. As you would have to do so every time on each single boot. 


You have to establish a route from Kali to the Server ( third VM). 
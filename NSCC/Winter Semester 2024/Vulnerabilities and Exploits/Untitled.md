



We will be discussing **Directory Service Vulnerabilities**. We will be looking at **DNS Vulnerabilties** and **ARP Vulnerabilties**. 




We will be getting an **Exploit Assignment** *next week!*



Tommorow is a *lab-class!*


Ron sent us a **CrowdStrike Activity** :


>https://www.crowdstrike.com/resources/crowdcasts/top-cybersecurity-trends-2024-series/?utm_campaign=2024trendsseries&utm_content=trends-crowdcast-series&utm_medium=emc&utm_source=mkto#register


----------------------------------


# DNS Servers 




What we covered on Monday was we examined the basic protocvol and functionaty of the DNS Structure. 


The vulnerabilityies ovcvur from the primary and seconday DNS server. The vulnerabilitty exists due to it bweing based on trust. It was meant for ewffeciently lookuing up informatuionm with a URL  (we know the URL). anmd we are looking for an IP. 


People did not imagine that others would mess with it. 


ARP works the same way, with the same TRUST MODEL> means there is no checking, if we do a query, the response woioll be from the real source. it sounds ridiculous in our day and age, and imagine what was on their minds of not considering malicious intentions. 


This is integral to Poisoning Attacks. Any system that is based on trust is vulnerable to this poisoning attack. In terms of DNS itself. Ron;'s gola is to look behind teh scenes and gain a deeper understanding. 



DNS servers, how you create them, etc .... --- <> to do !



Next week we will cover practival ARP and DNS activities. 



If someone sends a malicious request in teh query, or send a query to the malicious/fake ip address. 



MTIM --=- man in the middle  --->? look it up!



it is made possible due to teh Trust Model : The answer I get back must be from the real source. 


Utlimately if you look at the model, the authoritative source exists at the oprghanization. 




From URL rto IP binding sets exist at the organization, or a content delivery network setu up with a prixy. If you visit Facebook, you would be directed to a number of lcoations owned by Meta, and tehy are the AUTHORITATIVE source. They are repsonisibkle fo maitinaince for everything in the subdomain . 


Insterad of goinfg to facebook . com , you would go to services . com. RThere is something before the home domain. the dining iof subdomains to the domains and how you reach them is the repsoisinitlety opf the authoritative source. 



If you get a non-auythoritative response, you are getting it from a CACHE. it could exist on the LOCAL MACHINE. 


The cache exists at tyhje primary recursive router, or secondary recursive server ( at the provider). every point is keeping its own cache. 



What kidnd of information available at the DNS system ? 



It is more beyond querries. 


The TTL , number of seconds that it has to expire, where qwe would be foced to check up the chain . 




#### Statemenf of the AUthoritative Authority


$TTL 86400
@ IN SOA
SOA

MNAME: the primary NS for this domain (ns.ron.com)

RNAME: email address on domain administrator (contact)
SERIAL: 1 (when this changes, secondary NS update their records)
REFRESH: Num seconds for secondaries to wait until check soa.
RETRY: Num seconds to wait until second attempt

EXPIRE: Num seconds to try until no response from above.

bhe server is maintiaining a whole lot of information about the zone, 



Google.com would have nameserver.google.com


There is a name server whose job is to maintain all the records and keep acucurate bindings between the name and the IP address that yuou would be actually prividing you withj informauiton. 




We have a primary name server @ ns. ron .com , and you may have a secondary backup if you will., an alternatve name server. The information hgas to be copied from thhe main namesevrer to the backup server every time a change happens. 




It is important that the backup copies the information to itself. The copying is called a ZONE TRANSFER :" 


The nameserver/dns environment : copies all the information to the backup server every time a change happens. IF we are thinking, maybe there is a possibility to get a copy. If there is an automated system that will transfer this information, it shows a vulneravility . 


Remember if we transfer iunformation from opne business to another, and you can get that backup, you dont to break into the business to get the information you want. IUf you share too much information online, such as that I am the domain administrator, and you go to the website with your poctyire with a description of your duties and yourself, which should not be shared. If we are ress[ponsible for back]
ing up anything, you dont trust the main backup system/service. If this fails, you are fired. Everyone who is respoinsble keep their own copy, and sometimes it sits at home, which means it could be attained from there. IUf you carry a heavy briefcase, tyhere is a good change there are valuyable information in that briefcase. 


Sharing information about who is repsoinsle for IT functions is a bad idea. It is a a bad idea to share it on social media. 


SOA record : Referesh the number of seconds that the secondary backup server has to wait before checking for changes. 



A number of seconds to keep trying expires if the server does not het a coppy 




There is a resource record associated with the DNS database, for ROn.com , it contains a different bunch of daYA . 








NAME: ron.com

TYPE: A,MX,NS,PTR, CNAME

CLASS:

TTL: Num seconds resource record will remain valid

RDLENGTH: Num octets in RDATA

RDATA: data

RNAME: email address on domain administrator (contact)
SERIAL: 1 (when this changes, secondary NS update their records)
REFRESH: Num seconds for secondaries to wait until check soa.
RETRY: Num seconds to wait until second attempt

EXPIRE: Num seconds to try until no response from above.






tHERE ARE INFORMATION IN A DATAFILE. wE NEED TO KNOW HOW BIG THE RECORD IS , AND WHEN TO STOP. 


Email address of domain administreator is good to have. The A record can bee really imnportant. This is the main thing you get back from the domain srrver. it is the Ip address binded to the URL. Translates a doomain name to an ipv4 addresks. it is 32 bits 8.8.8.8.




There is a AAAA record is a 128 bit address. 


Translates a domain nmame to ipv6 address


32.32.32.32.  = 128 



MX record : mail exchange server. if you want to send mail tio the organization or get mail out of the organization, this is the server to do it. This is valuable. If yu could monitor it,  change it , what does it mean as it in tertms of weraknesses ? 


They are all trust based directyory services. Designed to be fast and effecient without a thought of security. If it is 1970, you would think why would someone do malicious things to it? 


It is thinking like that paved our way into a career, 


NS Record : nameserver record : authoritative name server for teh domain. Responsible for resolving subdomains. 




YOu can do a REVERESE DNS. THERE IS A LINK called Centralops, and it performs a reverse DNS and other lookups. /You give it an ip address of someone that is talking to you, and the DNS server returns the actual URL, the name associated with that domain. if you find an IP address in your network, you can do a reverse DNS lookup. The way that it does that is interesting. 
REcord Pointer record : takes an iup addrdess reversed ot , you add a in-addr to the end of it. ,you end up having a specific subdomain of a subdomnain of ARPA : 
It knows the site by its CNAME : 



PTR Record â€” Pointer Record

Does the opposite of the A record.
Maps IP addresses to domain names.

contains the ip address backwards and adds in-addr.arpa to the end
of the string.

example: 10.0.0.1 would become 1.0.0.10.in-addr.arpa

A lookup for this ptr is then done to return the Domain Name
associated with this PTR.

This is how Reverse DNS works.

Might not return a name you are familiar with because you only
know the site by its CNAME





If you put the ip address and you it it in Centralops, and you get the CNAME of who you are looking for (This is how you do Reverse DNS).  10.0.0.1 ---> 1.0.0.10.in-addr.arpa



TYhe other practical use of Reverse DNS is the mail systrem. DAL implemented this : 



You get an email from ron.com, and you associated with this traffic is the IP address of Ropn.com (supposib,ly) the ip addres has to be correct to enable traffic back and forth, You could be ling about Ropjmn.comn/. You could say its from Ron.com but it ccould be from China. How owuld you find this out? YUou 



You can build a reverse dns system in your mail system so it does lookups of the actual url of the domain stored in the DNS system if they don t match, the domain that it is supposiblty coming from is different, you can reject that email . Simiar to the whois command,. 



The only issue is : 


There is one name that the DNS record will return, somertimes uit is not the same name , reverse dns could be misinterpreted. the name it returns is a CANONIOCAL name , agreeing to a predictable rule. 


You can use it to create aliases, you would do that if you had multiple servers serving a single domain. if you go to facebook,.comn , and there are dozens of servers serving it, so traffic gets directed to a differewnt ip address. 


it could be a fullty qualified domain name in another dns zone, and then it returns the right informaiton thgat you want. 


CNAME canonical name is the name you get returend from the reverse dns systemn . it might be different, and it could cause suspicions when none are warratnted. 


SRV Record : Service Recod . is FTP available? is SSH available i? is RDP available ? is TTL available ? what if there is any srrvice at the site not known to the general pubnlioc ? if you see the service record you would know that it actuallty exists in the zone record. 



TXT record - Text Record -0 Rons' facvvourtie


Text record in the DNS system is a place to type notes to oneself. if you cant reach me at this phone nbumber, you can reach me at that phone number. I need to remidnd myself to fix security on this server. ADMINS put all kinds of information on this . 



zone "ron.com" IN    ( found in name.d in unix/linux)

{ 

type master; 
file "ron.com.zone";
allow-update ..............



}





![[Pasted image 20240110141354.png]]



This will be useful to us next week. 







------------------------------




Intro to **ARP SYstem**






Address Resolution Protocol : we will do a deep dive on the protocol next week. 



Big assignment ": compromise the system "




Most haver a general understanidng of the ARP system : a way of binding an ip address to a MAVC address. 


This sounds familiar: we have something we know () IP addres,s and something we want, MACV address. 




We need a MAC address becausew its the only way to send traffic to the lcoal network. We canot' uyse ip address to find a machine exclusively, we need the ip address to return the mac address, and we send a packet to the mac address . 



![[Pasted image 20240110143321.png]]



We will go over it next week. We ahve a computer whcih we will call MAC 12 : 


Normally a mac address is a 48 bit hexadecimal number . we dont want to write a 48 bniut hexadecimal numbers, thuis aka MAC 12 )(mac address of one computer )



We have an IP address that we want to talk to : we are looking for 192.168.2.13, they are somewhere on our netwrok and we do not know where. we dont have an entery to our local ARP cache. We have a table locally acalled teh ARP table , which has tyhe bindingd we know about , ip address / mac address. we attempt the use of this cache to find a  binding to send a message to the other compuer. We need to find it : 

Steps : 

1. ARP Rewquesuy ": op code 1 " 

We send a broadcase. We are used to broadcase address of ipv4 being 255255255255. all the bits to 1


/24  192.168.2.255

The same is true in the mac address world, there is no network part!@ ipv54 world :" we ewant ot send a broadcats packet , with the packet having the address of the network and addrtes ogf the hpost. if it is /24 ior /16 / 8 ,, the part of the ipv4 address (host address ) is t.



Mac addressing , OSI level 2  of the network stack , there is no network porttion, just host addresses. and mac addresses which is inbedded into your pc . The only way to legitimately change the mac address is tswap the network card. 


Broadcast to the local network and set the destination address to 48 bits of 1 : 

ff:ff:"Ff:Ff:Ff:ff  , each of these is an 8 - bit octet f = 4 , so there are 6 of them , so 48 bits. 


This will be processed by every network card, and injest the information. unless trhe mac address is specifically for you, yoru NIC ignores it unless one other condition is true : NIC being set to promiscious mode. If it is set to this mode, every mac address that is seen crossing the networl wilkl be ingested by your machine whether it was bound to it or not. 


1st step : I am at mac 12, trying to finmd the ip address,oacjet sats :L my mac addres s is mac 12(48 bit address), my ip addfress is 1102.168.2.12 m where is 192.168.2.13 ?




That message is received by every machine on the local netwrok. The actual machien we aree looking for recieves trhe message ,a  nd stores the fact in tis ARP table that this second machine will update its own table (mac 12 has this up address ), to answer the query


ARP Repy ( op 2) 


It will unicast to mac 12, my mac addr is mac 13 , and my ip is ..... it is unicast back to the original inqeuetrying machine 



step 4 : mac 12 stores in its arp table that mac 13 has this uip address ,so it knows where to send thwe packet to. 

This is a TRUST model, this is a directory service with a trust model, effeciuent system desiged to produce accurate informaiton. There is no need to put security checks to mess with it; 



We can see the vulnerabilitoies exist : there are ways to utilize it : 


1. The initial message --> Uoir mac address may be correct , it will be, but yuou are lying about the ip address ( which is from another server on their system , which you duscivere dfrom network probes enumerating the network) . Every machien receives this message, due to it being a broadcast, thery will all upodate theri ARP tables and make note of the malicious ip address. evertytimne they need the critical server, they will go to you instead . MITM! anything you do is up to you as an attacker






We will execicte thus atrtakck uin the big assignmebnt in 2 weeks!~






We will dig deeper next week!


![[Pasted image 20240110144807.png]]


Terms L: 


ARP stuffing :  Rerdirected connected Iot devices to a malicious device to permit it to configure the iot machine

arptables  add on to linux to allow filtering rules for ARP, like iptables

ARP proxy allowing two network cards in our computer , with one being attached to your local network, and another attached to a different network.  



ARPTable or cahce on the lcoal machine, we can see that by : 


	arp -a

On CISCO : 

	show arp


![[Pasted image 20240110145035.png]]





It will show all the bindings between ip addresses and mac addresses that your machine is tallking to 



Two desigbnations for buindings : 


1. static associations mac -- to ip


2. Dynamic discovered through arp requersts and responses, which will change over time. 


Static : 
The association is assigned automatically when your machine starts up. it could go to broadcasr , 255, multicast , 234. ,239. , etc 

Dynamic : 

when the result is put in teh ARP table , it is labled as a dynamikc request. 



What we will do in the next assignment we will do ARP spoofing in different ways. We will pretend tto be someone elser,. and cause a compyuter to pyut tyhjre wrong entry in their arp tables to intercept traffic or to pretend to be a leigitimate desitination on the local netorok. 



Imagine being a key server bertween 8-10 am in the morning, and you get all the login credeitnals , patch yuop the arp table and noone will know you were there. 

mitigation with trust models is by changing the ewhole model (we wont.../), a hugde padlock \

With cisco devices, you have device s that monitor arp rtequest and replies and detrecs phony/fake machines. YOu can do arp inspections, and do DHCP snopping , wher eyou watch an entity get assigned an i[p address from the router,m and the router will give you the next abvailable ip address. what if someone else wwho sis not enabled to do so does that ? ]



There are two categories to get an ip address 



static : talk to me on this ip address. It forgoes auttomatic sassignm,ent by the router. You could step over someone else's ip address , or when you turn on the compyuter and you arer not connectef to any network, the compyetrer needs an ip address to function, it needsa to have something. That ip address you get is a 169. address. if you arte looking at ipconfig , and you see it is 169. you wont be able to talk to anybody. This is assigned in the absence of anty netwrok connections. 



DHCP used to be called BOOTp Boot Protocol 


Dynamic Host Configuration Protocol : Assigns ip addresses from a remote network manageent device , a router. 


We will learn how to set uop a dhcp server. it is important that if you wish to break somewthing, tyou need to know how ti wokres. 



Two thinsg can happen if you understand the protocols : you understand why a hack works , why a vulnertabiltit is a vulnerabil;it , and you can imagine hacks that were not done yet. Those who follwo a career in offensive security . 
DIVE IN THESER PROTOCOLS. UNDERSTAND THEM WELL!!!!!!






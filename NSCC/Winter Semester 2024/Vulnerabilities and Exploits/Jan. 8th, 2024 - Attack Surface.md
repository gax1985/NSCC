



We have a *treasure*, surrounded by the organization



The perimeter of the building/organization is where the clients are around the world. If someone is in a hotel in Boston working, then the attack surface includes this person. 




## Attack Surface 


	Any surface in geometry is defined by a set of vectors. 


## Vector


	An arrow with a magnitude and a direction 


The vector in cybersecurity refers to an **attack** by threat actors with different techniques. 


TRhe direction of the arrow is focued on the target (people.). The magniture of the vector is the *strength of the attack*. All those things together form the **Vector**. Direction point --> people , magnitude --> strength .





#### Network Vector




#### OS Vector



#### E-Mail Vector 



#### Physical Environment Vector (Building itself, vehicles, etc ...)



#### Appllications Vector




#### Internet Vector




#### and so on ....






All those vectors together form ... 



### ... Le **Attack Surface**






Remember : ATV model ! In order to have *risk*, you need those three things 



A ssets


T hreats


V ulnerabilities




If you have none of those things , you have no risk!



We used the bridge example  :



                       RON
----------------------------------
             Water



Intention : 


cross the bridge 



Asset : 


Ron's Life



Threat : 


Drowning



Vulnerability : 


Rotten board




Ron would have *risk* with this bridge because **ATV** is present.



He can come up with a *Risk Plan* to remove the risk. He can remove one of the **ATVs**. He could not remove the river , but he can remove the vulnerability. There are many strategies 




### Risk Avoidance : 


	Dont cross the bridge 

 
### Risk Transference : 


	Sending a student across the bridge 



### Risk Mitigation :


	Mitigation is NOT elimination. Mitigation is REDUCING THE PROBABILITY of the risk! Ron can fix the board. Other things could happen, such as ice on the bridge, questionable carpentry etc... When thinking about risk, you have to think about what you can do about it. 


Threats are ALWAYS present, such as threat actors, hackers, malicious insiders, silly employees... We can do something about the assets. When dealing with risk, we have to think beyond hackers. We are protecting systems and information, and there are other threats such as data corruption, system failures, storms, power outages , the building catching fire etc...  we can do alot with the assets to protect them. We can make sure that our information is stored and backed up properly somewhere else. It should be backed up in a way that is disconnected from the network. Ron mentioned that he used to manage IT systems for the hospitals, and in the first two weeks, he discovered a lot of terrible issues, such as backups being placed in a safety deposit box, and the key was widely available for anyone to grab. He walked to the bank, spoke to a teller, and the teller pulled the file containing sample signatures for authorized individuals, which he signed Mickey Mouse, and she did not look at it. He asked for the manager. 


There was a service from Dalhousie's main IT division. Servers were backed up across the network. Ron mentioned that the backups were made of the organization's tapes. The Arts and Administration building is at the end of the campus. He was informed backups were stored off-site. It was in the Tupper building. No one had checked and it was in the same building. You would have to check what the employer thinks is in place, and check how well the risk management policies are. We have ALOT of analysis to do to understand the assets we are trying to protect. 

There are formulas that would indicate how much you should spend on an asset's risk management, but you can not spend more funds than what the asset is actually worth. We can not do anything about the threat. 


The earlier focus of cyber secutiyt professionals is THREATS. It backfired... 


People do not understand what they are protecting!


The **information** on the machine is the asset!



In the evento f a fire or a flood, plans have to be in place. Information is not as visible. Reputation would put an organization out of business. 



SolarWinds software is completely out of mind, as the reputation damage was done.





## Vulnerabilities


There has been a decrease in malware when it comes to vulnerabilities. Log4G, appache struck, ROCKSTAR vulnerabilities, and someone will develop a malware exploit. 




Nowadays, a lot of the exploits do NOT use malware. Nowadays , **Social Engineering** is ever more common. *People* are the biggest threat. People do silly things, such as clicking on email attachments, visiting suspicious websites, posting too much information online ( MGM Grand hack studied an individual that worked with MGM Grand). We will be discussing vulnerabilities with Bryan. 


*E-Mail* is the reason for **ransomware**. Keep email internal only! If the staff need an external email, then they can do so on their own personal devices. We could use *whitelisting* of devices, and all these things are much easier than getting a *ransomware attack*!




People have outsourced network processes outside of the organization, as they would be more specialized. 



A network is *poorly managed*, rarely *monitored*, and rarely *logged*! Ron found vulnerabilities in every single network. They are not as visible. 




What is the number 1 reason physical barriers are reached ? **Unlocked Doors**. 



**Apps** are everywhere! most of teh apps we do not actually need. 



The name of the game is : 


> Make the attack surface as *small as possible*!



If you have 100 acres to protect, it is much more difficult to protect than one's backyard. 




The updates that happen to apps patch vulnerabilities every day. The internet provided access to the whole world for a business venture, but it has a world of attack vectors and vulnerabilities. Throw everything out (apps) that we do not need, and start fresh (audit - start over? start over is the right answer!)



#### The key is : 


> You have to be ABLE TO SEE IT! The attack surface is not visible per se, but your consciousness can be trained to *see it*!



If someone left sensitive information available for anyone. 



What can one do about leaving thier computer unlocked? 


	 Automated lockout policy (-3 minutes?)



Do not necessarily punish offenders, but visibly reward those who get it right! It could be a symbolic reward!




Over time, you get repeat offenders, and then you can recommend a sort of fitting punishment.




If someone has a **weak password**, length trumps complexity! a longer password (15 charatcters +), the attack time goes up exponentially with every letter added. You need a STRONG password for the password manager.  Changing passwords are necessary; the thought is : passwords are eventually discovered. Everytime we change our password, we could expose the password. Passwords should be changed 3-4 times a year, and it has to be *new* passwords!



If someone has a **careless employee**, they do dumb things, such as building systems, managing systems, or they make mistakes with behavior such as unlocked computers etc...


Almost every organization has a *flat network* with oneIP range. You monitor that IP range endlessly, YOu monitor endpoints, monitor logs, and you have someone else montiro the logs. 




What the average time of patching vulnerabilities? **three months!**


Ron used to find almost 200 vulnerabilties unpatrched ,and some of those were unparcged for *years., 



How can we create a **culture of security** in the work place? If you go about changing things the wrong way, you could irritate a lot of people. It helps to train employees where you build relations. Things start with *policies*, which have to be approved by the *management*. If someone recommended a policy, it helps to make sure one is walking into a minefield! We have to covey **WHY** we are doing this?**






## Our Starting Point 



We will be looking at *categories* of attack vectors to be exploited. Bryan will focus on the vulnerabitlites, and Ron would be more general. 



Ron can show us an RDP hack, and one could learn how to do so from Metasploit or elsewhere, but we would not be understanding **WHY** we could do it? Ron's method is to have us understand RDP first!


The issue is the broken board in the bridge. the issue is that it is there in the first place. Things could be designed poorly, which makes those vulnerabilities inherit in them. 4



The first thing is : 


## Concept of Directory Services



There used to be an **Internet Phonebook** for every company or person who had a domain! 


**Directory Services** are like a phonebook where you would use information you know to find an etity. We have something thaht we know that we use to find something we do not know! 



## DNS



If you type CNN.COM, your computer knows you want to go there. The PC would look for Facebook.com in a directory, translate it to an IP address, and go there. 


In order to reach a certain machine, we would need to reach it via its NIC's MAC address. It needs a directory to look it up, such as **ARP or Address Resolution Protocol**



The other is **LDAP**, which is **Lightweight Directory Access Protocol**. It is a small piece of software to find information on a network. If you are finding someone's email address in Outlook, you start typing the bits of their name that you know. 



We encounter **LDAP** on a daily basis because it is the software behind **Active Directory** and the **Domain Controller**. ALl the necessary information for them to work is in **LDAP**. The underlying software is the same



Directory services start with ...


	Something we Know, 



and it will give us ...


	Something we want




Directory services have a :

1. **Client**
2. ... who goes through a *local server of some type* ...
3. local server is installed on the device, or nearby ... 
4. ... a *secondary server , which is one level above the local server* ... 
5. ... eventually , a top level server that knows about everybody, such as Facebook ( **Authoritative Server**
6. ... This top level sever woyuld have a *table* which has Facebook's IP address



DNS Servers can have **Sub-Domains**, and we know it is a *sub-domain* because the dot appears before the real name. The client is the local DNS cache on the operating system. 




![[Pasted image 20240108184059.png]]






The primary recursive DNS server, and the local DNS server would both have a **DNS Cache**. We have an IP address, but its *time-to-live* has expired. The secondary server would be with the provider for example, which would be used to check as well. 


PRIMARY
SECONDARY


If the entry in the secondary DNS server is also expired ... 


	When the machine sends the question " Ineeed to find Facewbook" it attached a query ID, because we are looking up stuff all the time. Recall the number of unique IPs in a 24-hour period is 2000 IP addresses. Each of them has to have a DNS query associated with it. 

So we would have to check for this **Query ID**, which follows it through the chain... 



When the *Secondary server's Recursive server* does not have the information, tyou have to find the ROOT of the DNS server (primary) and it knows about the **Top Level Domain Servers** such as .gov , .com , each opf them has a TOP LEVEL DOMAIN SERVER (for .coms for example) as it knows where the **Authoritative Name Server** for Facebook.com. The **Authortitatve Name server** finaally gets the IP address from dozens. 



How dopes the seconadry the server came from TLD ? it does not!


How does it identify the respmnse? by the Query ID. 


Ron pointed out the vulnerabilities of almost any *Directory Service*






You can attack the Secondary Recursive Server if you wish to discover everyone who visits a site, you do so by guessing the Query ID, and you find the Query ID of the site you want, you would be accepted, it gets added to the Secondary Recursive Server and its time to live lasts for months!


This is the reason why 2FA is important!



The secondary recursive server is TRUST : if I send a response with a query iD, I trust the origin of this query ( the system ). Until 2017-2018, it was the basis of the DNS system. Every DNS server for any organization (small-medium sized) , it is still that way. They do not know the DNS server exists. It is the way it is. 



last year, he stopped issuing a vulnerable DNS server assignment. 



What could we do to solve this ? 


We need a **Certificate** owned by the organization's system , and associated with the query, and only when the **Certificate** is proven, the query is processed. 
We can **randomize the ports!**



Look up the DNS Server's PORT!




in 2017, the old DNS software was deprecated, and a new secure DNS was created. It provided random ports, certificate authorities, and randomized query IDs. If we install a DNS server in the past five years, there is a good change we installed a Secure DNS Server. Anytime from 1988-2017, systems are vulnerable. As a result, there are thousands of DNS servers where this attack works!



The reason why Ron stopped issuing the assignment was previous students would complete the steps, and it became very difficult to find those components (scattered pieces of code), and it took the students two months to do so! We would need five peices to put it together. The vulnerability still EXISTs. This is ... 


#### DNS POISONING ATTACKS



They can be used in any Directory Service based on the same principle! 


I havee something (name), I give it to directory serrvice, and trust that the answer os not hacked. Every directory service is vulnerable!



We will learn **ARP Poisoning**, where a request to communicate from a client would get the malicious entity's IP address instead ...


This is why we discuss **Zero Trust Networks**!


Primary DNS is sitting the router, secondary DNS is with the provider. 


If a fake query ID gets accepted, the genuine query would be ignored, because the DNS server processed the request, so sending out a multitude of query IDs would poison the DNS :D





Ron wants to teach us .. 


>Why are they vulnerable?





## Next Class :


LOG4J vulnerability , where it contains executable code. It is **Still Vulnerable**! 



When Ron teaches us a Wireless vulnerability, we will understand why it works!



We could spot other ways where we could compromise it. If we understand why the system works in detail, you could create your own exploit, which the adversaries do all the time. 













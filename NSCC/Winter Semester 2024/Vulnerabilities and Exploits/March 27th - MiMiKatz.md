


When you log in to Windows, the login credentials you are entered are hashed, and provided to the system. 


There is **SAM Database** that stores *hashes*!


In the database, it contains simply *username* and *password*!


The algorithm used on this database Network Tech LAN Manager  --> NTLM Hashing!


When you are typing your password, you are talking to the LSA, which will hash the thing you type, and it will compare it to the hash stored in the SAM database, and if matching, lets you in!


Anything that deals with the Local Security on the machine is stored in the SAM database on our machines.


if talking to the Domain Password, it is stored on the Domain Controller, but also stored locally on the Security Database. 


The strructure of the database used in Windows is very old. It is hierarchical, due to it being the standard at trhe time. 


hierarchical structure looks like a tree


When looking at the regisrtry editor, we see it has a tree format 


The files in the registry are called hives. Why ?    

# .hiv files

One of the developers on the team had an intense fear of bees. the rest of his team made the reference out of spite.  



We will grab the Hive Files from the machine 


We need Windows 10


We will creater a local admin account , and give it a passwortd () a week one


We will extract SAM and SECURITY database with MimiKatz


Oncew we have them, we will extract the hashes of the passwords from the registry files


Will use Hashcat to break the password





## MiMiKatz



In the simplest form, we can get into someone 's computer, yuou do not have to be admin, but you need ADMIN rights. it is not a weakness, as most have admin rigths on the poc '. 


Who does ADMIN rights other than IT ? 


**Executives** 

this makes them vulnerable. You can download the local admin account on the computer


If we have a local admin account and we have access to it, the user did not create the local admin account. The IT department made it for convenience to fix the machine, so it will be easy for them to fix it!


Often , they use the same credentials on every machine on their domain. This is standard practice, and this is our way in. If we can scrape the hash of the local admin account, we can use the hash to get into any machine on the network. 


### Why is this possible ? 


We are not typing anything. It is all done with a malicious program downloaded to their machine,  or USB drive, or any other way. 


When you log in to the account, and you access different segments of the school network ( like checking grades ), you are constantly moving from server to server behind the scenes. If you log in to your machine, how do you manage to log in to all these services? 


You would often have to log in separately if you are faculty. The day to day activies are not seen, this is because of the Windows Sewcuerity functionaltity. If you are on Windows, and it need to talk to another Windows machine, it will go to the SAM database ( uif local admin), and if it is domain, it does to the Security Database, and it is taking the hash of the astored password, and it sends the hash to the compuyter you need to talk to. This is so the other pc does not need the actual passwords, but the hash. 


The malicious actor will scrape local admin's password hash, they use the hash to move laterally to any machine on the network that has the same password. This is most of them --> **Pass-The-Hash**. 



You have to think of it as an *executable Program*, which will go through the network. 



We will not do PASS THE HASH, but we will do the first step , which is how to attain the hashes, and then how to crack the hashes



---------------------


Under **Readings and References**, we now have *local administrator's account password-cracking page*. If we follow the steps, that would be the assignment. The setup is the difficult part : 


Windows hates Mimikatz, every browser except Firefox hates Mimikatz. 

Chrome will block it!


If you can download it, Windows will delete it automatically as soon as it is detected


Kali has no issues with it! 


You can do this in a multitude of ways !


Once you get Mimikatz to your Kali, you have to get it to Windows somehow. 


The way Ron did it : Opened WSL, installed Firefox, and downloaded Mimikatz. Ron spoke to Bryan, and Bryan mentioned a file called *metasploit-famine* (Now called VENOM)

You can use the old version!



A Metasploit you can take mimikat and it puts it in venom , so it adds phony signatures, creates an executable file with a new name ( it gets encapsulated). 


JUST TURN OFF DEFENDER. 



For WSL, you can download the components that you need into WSL, when Hashcat did not work for him, it was due to WSL. You can simply download everything to Kali. 



You have to turn off Windows defernecer, and move mimikatz to Windows. 



In the example on the Blog POst, they take both SAM and Security Database. We are just working in the SAM database. 

When you do the scraping , you get a liust of usernames, and their passwords' hashes.


You will create an input to hashcat that just uses the **username:password**. 



We should have an : 


## Introduction to MiMiKaTz



Get experienced with dumping credentials from the SAM and Security Databases. 



Ron : The only file that hashcat produces is a very suspicious file , which is from a DNS zone tyransfer. 



We will have the written  instructions for the assignment tomorrow.



If you choose WSL, download Firefox on it and download MimiKatz this way. 



We have little time. 10 working days!








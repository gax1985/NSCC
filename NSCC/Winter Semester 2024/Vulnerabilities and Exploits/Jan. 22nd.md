



We started off the course talking about Vulnerabilties in *Directory Services* (Where you have a piece of information which you use to lookup another *Piece of Information*)



It is set up on the **Trust Model**, which means that it can be exploited and vulnerable


We looked on **DNS**, which has the *DNS Transfer Assignment*



Please take a look at your current workload.


1. IPTABLES Assignment for **Firewalls**
2. Setting up a *Domain Controller*  for **Windows Security** due Tuesday
3. Assignment 1 for **PPIT** due *Friday Jan. 26th*
4.







------------------------------------------------------



# ARP Exploits 



Routing on local area networks is made possible by two tables/databases maintained on our computers : 


1. *ARP Tables* : It has two entries in there :
   
   
	   1. IP Address
	   2. Corrosponding MAC Address 


It is used because we can not use the IP address on the local network. The IP address is for finding machines **NOT ON OUR NETWORK**. Instead, we would use the *MAC ADDRESS*. Our computers need the MAC ADDRESS, which in turn it turns to **ARP**. It is tempting to post the MAC Address for every machine it talks to 



The ways the entry is made itno  the **ARP Table** :



1. **Request/Response** : If our IP address is 192.168.4.3 , and we want to contact 192.168.4.6, and we would send to the broadcast address the message " I am looking for the ip address ending with .6". The response from the PC with the IP address ending in .6 , and because we have the response, we add the IP address and the MAC address to the ARP table. This way, the computer knows the IP address and MAC Address so it can communicate successfully with the desired destination. 
   
   
>[!note]
> 	If the network card changes, the ARP table gets updated. If our target machine ending with .6 actually broadcasts to the network ahead of any request "I am the pc ending with .6 ,here is my MAC Address". this is called : 
>


>**Gratitiotous ARP : It is based on the Trust Model. It does not expect any malicious actions. 





# Routing Table 





The **Routing Table** contains a number of entries : 


1. IP Address we are looking for (192.168.4.6)
2. NET Mask (255.255.255.255) --> Why the extra 255 on the last octet 
3. Whether or not the IP address is *on the local segment* :
   
		1. If it is : Look at the ARP Table --> it will say "ON LINK" in the routing table
		2. The IP address : 192.168.4.5 (not our IP address, but the number of the interface in which the packet will leave the computer. We can have two NICs with different IP addresses. This is the IP address in which the packet will leave. It will leave 4.5 and go to 4.6)
		3. Metric : It is a number like 455. You can have metrics that run from 25 to 700, and tghe only thing that is oimportant about the number is the relative size of the number compared to other entries in the routing table. If we have another entry on the ourting table , and its metric is 100 as compred with 445. The metric is a measure of performance on that route, so the PC will choose the least number of hops. The larger number of hops, the higher the metric will be. The metric will also depend on the ACTUAL SPEED OF THE NIC. The only time the number has meaning is when the number is smaller, so the PC will choose the lowest metrric. 
		At the very top of the routing table ., we would have an entry 0.0.0.0 , 0.0.0.0 , 192.168.4.1 (router attached to the local link). If it can not find the destination on the local link, it will hand it to the local ROUTER ( I do not know who this is). By default , if the IP is not found on the ARP table, it gives it to the router. Ultimately, if the address is somehwere in Europe/US, then it leaves the netwrok, the router finds the route, and then we wait for the answer from the router ( a response). We do not necessarily know the route itself. 





>[!hint]
>
>We have links on the course shell for **ARP Poosining**
>*netstat* --> Command we will need
>ARP command --> useful for our assignment
>Automatic Metric  ( it is hard to get a metric of 0 or 1 : OS will put a number based on the speed of the network card. The lowest number we will see is 25 in a 10.100 network)
>Read those links! 











## ARP Table : 




1.1st address is a **Broadcast Address** : Physical *Broadcast Address* is ff-ff-ff-ff-ff-ff  (In the MAC Address world, it matches *every MAC Address!*). The type of entry is a **Static Entry** ,. where they are the default entries added on **BOOT**


Multipcast addresses to our network : We are used to Unicast, sending a packet to one computer. Multicast means we can send a packet to multiple computers on the local netwrok. There is another ARP table with 10.13.39.1 , with a physical MAC Address 


Dynamic Address: Addresses added while the computer is running, and it gets updated by interacting with other computers on the network. 


So first, it fills *Static Addresses* then *Dynamic Addresses* added from experience.


Each interface has a different ARP Table associated with it. 


10.13.244.6 


	arp -a -n 10.13.244.6


	-n        Only show me the addresses involved with this particular NIC/ARP Table


How does a system decide on the default NIC? 

If we go to *ipconfig*, we would see all the various networks the machine has spoken to recently. Every time you attach your computer to a netwrok, it attaches an ARP table associated with the NIC for the interface address. If we unplug it from that netwrok, and plug the NIC into a different network, it will come up wqith a new ARP table. 



(We see muticast addresses trhat are statuc, which means they were added on boot)



### Example from Windows : 


Interface: 10.13.232.114 --- 0xc
  Internet Address      Physical Address      Type
  10.13.232.35          74-4c-a1-6d-b5-af     dynamic
  10.13.232.47          ca-b2-9b-34-74-f5     dynamic
  10.13.232.87          34-2e-b7-9e-12-18     dynamic
  10.13.232.125         18-56-80-4c-88-71     dynamic
  10.13.232.140         10-f6-0a-8c-d7-5a     dynamic
  10.13.232.172         70-32-17-26-b0-29     dynamic
  10.13.232.178         ce-c9-a0-63-e3-f1     dynamic
  10.13.233.21          00-91-9e-50-dd-04     dynamic
  10.13.233.27          90-e8-68-8f-13-37     dynamic
  10.13.233.32          38-7a-0e-d3-a9-a0     dynamic
  10.13.233.51          e2-87-56-74-86-82     dynamic
  10.13.233.110         3a-13-eb-69-e1-05     dynamic
  10.13.233.129         38-00-25-f7-ca-c4     dynamic
  10.13.233.153         e8-fb-1c-4d-b3-45     dynamic
  10.13.233.165         14-d4-24-7c-a0-ee     dynamic
  10.13.233.166         0c-9a-3c-ad-bd-d0     dynamic
  10.13.233.195         58-ce-2a-a0-e4-b1     dynamic
  10.13.233.212         f4-b3-01-69-2e-45     dynamic
  10.13.233.216         f4-c8-8a-52-7b-e6     dynamic
  10.13.233.221         ac-19-8e-c7-0b-eb     dynamic
  10.13.233.226         20-c1-9b-ba-ec-99     dynamic
  10.13.233.248         dc-f5-05-cf-79-15     dynamic
  10.13.234.29          00-e9-3a-0f-ff-55     dynamic
  10.13.234.46          46-8e-89-74-ec-63     dynamic
  10.13.234.58          08-64-37-a8-07-03     dynamic
  10.13.234.84          00-04-a5-01-11-fa     dynamic
  10.13.234.92          00-04-a5-01-11-fb     dynamic
  10.13.234.154         f0-9e-4a-89-f6-3e     dynamic
  10.13.234.159         00-04-a5-01-11-e2     dynamic
  10.13.234.171         f4-c8-8a-ad-5a-ac     dynamic
  10.13.234.201         34-6f-24-a2-23-a7     dynamic
  10.13.235.2           c8-cb-9e-e9-dd-24     dynamic
  10.13.235.3           74-4c-a1-92-c7-d9     dynamic
  10.13.235.8           40-ec-99-f6-01-0d     dynamic
  10.13.235.10          4c-77-cb-10-b9-b8     dynamic
  10.13.235.15          70-32-17-01-1e-63     dynamic
  10.13.235.20          7c-b5-66-03-b9-25     dynamic
  10.13.235.38          4c-d5-77-65-00-61     dynamic
  10.13.235.65          20-c1-9b-c6-b8-67     dynamic
  10.13.235.71          7c-76-35-c6-df-54     dynamic
  10.13.239.254         f8-66-f2-96-a8-3f     dynamic
  10.13.239.255         ff-ff-ff-ff-ff-ff     static
  224.0.0.2             01-00-5e-00-00-02     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  224.0.0.252           01-00-5e-00-00-fc     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
  255.255.255.255       ff-ff-ff-ff-ff-ff     static

Interface: 192.168.208.1 --- 0xd
  Internet Address      Physical Address      Type
  192.168.208.143       00-0c-29-f2-d5-36     dynamic
  192.168.208.255       ff-ff-ff-ff-ff-ff     static
  224.0.0.2             01-00-5e-00-00-02     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  224.0.0.252           01-00-5e-00-00-fc     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
  255.255.255.255       ff-ff-ff-ff-ff-ff     static

Interface: 192.168.142.1 --- 0x13
  Internet Address      Physical Address      Type
  192.168.142.255       ff-ff-ff-ff-ff-ff     static
  224.0.0.2             01-00-5e-00-00-02     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  224.0.0.252           01-00-5e-00-00-fc     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
  255.255.255.255       ff-ff-ff-ff-ff-ff     static

Interface: 172.31.32.1 --- 0x20
  Internet Address      Physical Address      Type
  172.31.47.255         ff-ff-ff-ff-ff-ff     static
  224.0.0.2             01-00-5e-00-00-02     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
  255.255.255.255       ff-ff-ff-ff-ff-ff     static

Interface: 172.27.80.1 --- 0x35
  Internet Address      Physical Address      Type
  172.27.95.255         ff-ff-ff-ff-ff-ff     static
  224.0.0.2             01-00-5e-00-00-02     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
  255.255.255.255       ff-ff-ff-ff-ff-ff     static




IP ADDRESS OF A SPECIFIC MACHINE. BROADCAST/MULTICAST ADDRESSES

----------------------------------------------------------------

## Routing Table : 


	route print



This will show the *Routing Table*



10.13.232.0   .0 means it is the network's address. Notice the netmask 255.255.248.0 --- that network is available on Link , interface to get there is the interface address (current IP), if you want to send network traffic from this NIC, the outgoing address is 10.13.234.6


In the routing table, if the communication is going to a whole network, you see the ordinary netmask. If you are communicating with one single up, you would see 255.255.255.255 ( as a netmaskc)




### Example of a Routing Table : 



Interface List
  3...00 2b 67 a3 a1 8c ......Realtek PCIe GbE Family Controller
 17...8c c6 81 ec 18 d8 ......Microsoft Wi-Fi Direct Virtual Adapter
 15...8e c6 81 ec 18 d7 ......Microsoft Wi-Fi Direct Virtual Adapter #2
 19...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1
 13...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8
 12...6e 6e a0 f5 62 e2 ......Intel(R) Wi-Fi 6 AX200 160MHz
 24...8c c6 81 ec 18 db ......Bluetooth Device (Personal Area Network)
  1...........................Software Loopback Interface 1
 32...00 15 5d 32 2e 00 ......Hyper-V Virtual Ethernet Adapter
 53...00 15 5d d6 a1 ef ......Hyper-V Virtual Ethernet Adapter #2
===========================================================================IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0    10.13.239.254    10.13.232.114     45
      10.13.232.0    255.255.248.0         On-link     10.13.232.114    301
    10.13.232.114  255.255.255.255         On-link     10.13.232.114    301
    10.13.239.255  255.255.255.255         On-link     10.13.232.114    301
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
      172.27.80.0    255.255.240.0         On-link       172.27.80.1   5256
      172.27.80.1  255.255.255.255         On-link       172.27.80.1   5256
    172.27.95.255  255.255.255.255         On-link       172.27.80.1   5256
      172.31.32.0    255.255.240.0         On-link       172.31.32.1   5256
      172.31.32.1  255.255.255.255         On-link       172.31.32.1   5256
    172.31.47.255  255.255.255.255         On-link       172.31.32.1   5256
    192.168.142.0    255.255.255.0         On-link     192.168.142.1    291
    192.168.142.1  255.255.255.255         On-link     192.168.142.1    291
  192.168.142.255  255.255.255.255         On-link     192.168.142.1    291
    192.168.208.0    255.255.255.0         On-link     192.168.208.1    291
    192.168.208.1  255.255.255.255         On-link     192.168.208.1    291
  192.168.208.255  255.255.255.255         On-link     192.168.208.1    291
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link     192.168.142.1    291
        224.0.0.0        240.0.0.0         On-link     192.168.208.1    291
        224.0.0.0        240.0.0.0         On-link       172.31.32.1   5256
        224.0.0.0        240.0.0.0         On-link       172.27.80.1   5256
        224.0.0.0        240.0.0.0         On-link     10.13.232.114    301
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link     192.168.142.1    291
  255.255.255.255  255.255.255.255         On-link     192.168.208.1    291
  255.255.255.255  255.255.255.255         On-link       172.31.32.1   5256
  255.255.255.255  255.255.255.255         On-link       172.27.80.1   5256
  255.255.255.255  255.255.255.255         On-link     10.13.232.114    301
===========================================================================
Persistent Routes:
  None

IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
 19    291 fe80::/64                On-link
 13    291 fe80::/64                On-link
 32   5256 fe80::/64                On-link
 53   5256 fe80::/64                On-link
 12    301 fe80::/64                On-link
 12    301 fe80::4d23:b306:a3a9:c5c6/128
                                    On-link
 19    291 fe80::4e06:2eb9:58ed:5a5f/128
                                    On-link
 53   5256 fe80::5bbf:10e6:2866:7b89/128
                                    On-link
 32   5256 fe80::669d:c369:c862:801f/128
                                    On-link
 13    291 fe80::c2cc:be9f:26c9:8d12/128
                                    On-link
  1    331 ff00::/8                 On-link
 19    291 ff00::/8                 On-link
 13    291 ff00::/8                 On-link
 32   5256 ff00::/8                 On-link
 53   5256 ff00::/8                 On-link
 12    301 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None




The routing table : 


We have a lot of IP addresses of individual machines, broadcast addresses, network addresses, whtteher or not they are available on the link,. or if they are plugged in. The metrics attached to it. If there is nothing in this ARP table for the IP address , you go to the top row and send it off to the router. 


What we will do : 

Let us say that a particular IP address 192.168.192.1 (gateway address) on link . available on card 192.168.233.1. We can have a second IP address, and instead of being on link, we can give it a gateway address. we give it another IP address ( if you want to get to this machine, you have to inquire about it from this IP address. The matric attached is 25. The computer will choose the route with the smallest network.  



We have two routes : 


192.168.4.5
1. reese's machine : he woujld like to talk to a critical server on the server netwrok. She will have a route on the compuyter with metric 500 that is on-link. Ron puts it another route on the routing table, and instead of being on link , iut has to go to a gateway machine (his pc) 

192.168.4.6 
      Server Address : we tell it : much quicker route to go through 192.168.6.7 (make it a lowest possible metric. priority of using the route, the best route is the route with the lowest metric)




Now we have achieved the first objectivew ( forcing reese's machine to go to Ron's machine) . Ron could forward reese's message to the server, but before we do, we changfe the source IP to Ron's IP address, and then Ron will forward the response to reese ( changing the IP adrdess to the server's IP). Reese's machine and the server see nothing wrong. It does not matter that the communication went through Ron's machine. 


What can we do if we have intercepted ? 


User names/ passwords /files / modifying documents (ARP Poisoning) 



You can simply let the communications drop ( not send it anywhere! Vandalism  )



We can do this to everyone's tables : everyone who wantrs a service can be pointed to an entity to execute a Denial of Service attack from everyone on this netwrok against one entity. 





The whole routing paradigm is based on the **Trust Model**, which made it all possible! 



----------


### What can we do against this attack ? 



One technology on the Switch : Every port on the switch leads to a single computer. It is a wire going from your machine to the switch, and so on. 

In order to effeciently route everything on the netwrok, the switch keep track of the MAC address that is assigned ( machine attached to this port has this MAC address and IP address to improve performance on the network). 

The packet comes in to the switch bound for a specific MAC address, it does not know which one, so the switch sends it to all of them and the right machine responds. 


When the MAC/IP address binding is done, a database entry is added to the switch, so the switch has a record of that entity. It would show up as "ON LINK". 


If someone claimed to be the MAC address for the server, and the switch responds "That is not correct as of a second ago", this is called **DHCP Snooping**. It is looking fort any device on the network pretending to be multiple devices. This is a sure sign of spoofing , or **MITM Attack**. 



Or you can buy third-party products that can monitor the consistency of ARP tables, which watches if the MAC Address keeps changing. 


On average networks : network admins set up a system that works based on then same trust model.  They are building the networks the way it was intended, and according to how they were trained. They were not trained on ARP spoofing.  




HINT : We can make our machine in the middle with the same login screen for that user. You would have to be able to access their machine to make changes. If you do ARP poisoning, you both would have to be on the local network./ If you wish to redirect them to another machine in the institutiokn, it can get complicated if it is wireless (which means you do not have to be in the building itself. You can do MITM with WIFI!)



Route table : When you ha ve an ip address in the ARP table, it goes to the ARP table to find its mac address. if it is not on link, it sends it to a gateway. You can have subnets , and you can have gateways, and you send them off to different gateway. If we have a route in the route table, and we have a route to get to a server ( route to an IP address). Your computer will look in the ARP table to check if the IP is on link, if it is , it will go to the ARP table to cghck the MAC address. if it iis not there, it will send a broadcast inquiring about it. For statuic routes , they get populated as soon as the PC boots up. Dynamic goes away between boots, but gets populated when contacting different pcs and destinations. You can do : 

ARP Flood 


------------------------


### ARP Flood :

Static routes are assigned by the OS> Dynamic routes are populated while the machine is running. We would like to puit a route in tghe rtouting table and have it survive reboots! If we want to be MITM, we want the MITM entity to be ALWAYS there. We do not want the victim to reboot. We can create a **persistent route**, which stays. If we are trying to get to 192.168.2.10,m everything trying to get to 2.10 go to another machine on the network before it gets to Ron's machine. When you put a malicious route through the network, you want it to be a *persistent route*. 





-------------------------------






## Next Week : 



1. Manually change the routing tables on the machine, with 2 VMs
2. Route from one VM to another VM
3. Modify the routes from one VM to send it to a third VM
   
   
   (We would manually do each step ourselves!)


Once we have mastered that, Ron will show us an exploit script that does the same thing. This way, when we do the steps ourselves, we understand each step. 




TO DO : 


1. Ron will go over references each class. When reading them now, they will make sense to us. 
   Spend a little of class time this week to read the References. Ron will talk about one each day. This is the plan for the rest of the week. 
   2. Next assignment: Route modifications on an ARP table to conduct a MITM attack 




## The TCP Three-Way Handshake 




We have two computers who are trying to talk to each other: 



COMPUTER 1                                                                                   COMPUTER 2


Hello1 (SYN-Flag + Packet + Seq #1)           Hello Back1( SYN/ACK Flag+ Packet # *ACK# =2 (1 + 1)*)     




The Flag Portion: 



Hello! 

FIN URG PSH TST ACK SYN
0     0   0     0           0    1

Seq # 1 

Hello Back! 


FIN URG PSH TST ACK SYN
0     0   0     0           1   0


I heard your Hello! 



FIN URG PSH TST ACK SYN
0     0   0     0           1   0





The dialogue : 


1. SYN (Seq. #1 )

	Sent to a specific port

FIN URG PSH TST ACK SYN
0     0   0     0           0    1

2. SYN/ACK (Seq #2 --> 1+1)

FIN URG PSH TST ACK SYN
0     0   0     0           1   1

4. ACK (Seq# 3 ) 
	ACK# 203

FIN URG PSH TST ACK SYN
0     0   0     0           1   0

If the dialogue ends : 

FIN 

FIN URG PSH TST ACK SYN
1     0   0     0           1   0


The other side responds : 

FIN/ACK

> [!check] 
> SYN Flood Attack
> 


> [!todo] 
> The Dialogue itself 



What happens if instead of a SYN flag, we send a FIN flag?  


The other side is confused. It thinks that it has missed something, possibly missing sent packets? The server reveals information about itself. 


We can send all the flags. 


If there is no application open on a specific port, the port is *closed*, which is good. 



When scanning the network with NMAP, we need to look for an undocumented open port. 


Why would this port be open ? 

1. Software installed previously, and not removed properly. 
2. An Anti-Virus program installed on a network computer, and it has a server on the network. The server is removed, changed to a different anti-virus, and the client is still trying to find the server due to it not knowing the server is removed. 





#### Intrusion Prevention/Detection Systems


They keep patterns of behavior on the network. It would recognize malicious behavior. We will cover this next semester. 



##### The difference between IPS and IDS :


**Intrusion Detection System** notifies you that there is something wrong. 

> [!example] 
>  Intrusion Detection System : 
>  
>  A friend who has invited you to a party, and you see someone grabbing someone else's beer. You would notify the host, who replies that this is his cousin. 



**Intrusion Prevention System** stops the attack while it is happening actively. 


> [!example] 
> Intrusion Prevention System :
> 
>In the same party, with the same situation, this would be a bouncer kicking out the unwanted beer-grabbing guest. 


Every piece of software or hardware adds a potential vulnerability to your infrastructure. 



Irving is a potential work term, so in their case, they would check and evaluate every *IDS/IPS*. 





When we were doing our network scanning, we were sending *SYN* packets to many destinations. The response would let you know that the port is open. If the port is closed, then it tells you that it is actively being blocked. This scan would reveal intelligence. All information that you get from this would enable you to make assumptions about behavior. The absence of information IS information. 




What does it mean if we are doing a scan, and the port is *filtered*? 


There is something between you and the destination that is not allowing you to receive information. It could be a firewall. The packet can not get through to the firewall. 






> [!question] 
>  How does it know if it is closed or filtered? 
>The port is filtered, so there is something blocking the communication. 


> [!question] 
> **Are ports used by multiple applications ?** 
> No. When communicating with a node, it would indicate a source port (your computer's port), and a destination port.  There are two different conversations, due to the way the conversation is represented in the destination database. The primary key of the destination database on the destination machine uses the "FIve Tupple" : Source IP, Destintion IP, Source Port, Destination Port and Protocol. All the five represent the PRIMARY KEY. The two computers could be using port 80, but the source port would be different. The sequence numbers are generated by the computer when making the connection. The only thing that matters for the same coversation the information has to be the same. One can cause confusion if the IP is spoofed. 
> 


We can do something called **Reflection Attacks**. 


##### Reflection Attacks 



Malicious Actor's computer                                           10000 Servers 

1. Sends SYN packets to the 10000 servers to 
   3306 (for example) 
2. Changes the source up to (.456), thus all the 
servers think that the victim is the malicious actor


 
 Spoof the source IP (Last octet for the victon is .456)
Victim (bombarded with packets)




We can spoof most things with packets. With China, they can spoof packets to turn the attention away from them. When making accusations about the attacker, the IP address is the first step. Human intelligence is key! The Chinese do not care really. 


You can use this for **Covert Singaling**, where instead of the victim, there would be a partner. You would send your partner a signal to communicate with them in some way. Everyone would be watching the malicious actor to see whether you are communicating with your partner. They are watching your partner, where they are trying to see who your partner is receiving information from. It is arranged in advanced if you are getting a FIN, RST, ACK from the server. The malicious actor would send a SYN packet with a spoofed last octet (.456). The eyes would see that the SYN, FIN, ACK packets are sent and received from your partner, so this way, you take attention away. This can be done with PINGs with a **PING Flood Attack**, where the intention is to exhaust the bandwidth. 



> [!question] 
> **Can this be blocked?** 
> It can from your router. Whitelisting and Blacklisting is used. Whitelisting is deciding which IP addresses you can communicate with. If you are not in the whitelist, you can not communicate with them. Any attempt for a packet leaving the network will be blocked. The most common approach is Blacklisting, where you start off letting packets go anywhere, but define an entity that you can not communicate with. They would blacklist dating sites, porn sites, online gaming, etc. Over time, the Blacklist grows bigger and bigger. If you get an email that is a SPAM email or Phishing email, you can add this source IP to the blacklist. You can force a legitimate IP to be added to the blacklist, so you can spoof that IP address to point all the communications to your system.




> [!todo] 
> 1. Read up on **nmap.com** on **Port Scanning Technique**
> 2. Scan 127.0.0.1 



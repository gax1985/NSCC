


Capa analyzes the malware and makes a guess at its **tactics** and **functionality**  
it does? 

Questions this tool answers  
● What Mitre Tactics does this do  
○ Execution, Credential Access, etc.  
○ Essentially our course outline  

● What can this file do?  
○ read/write files (ransomware likes to do this)  
○ Sockets (reverse shells and data exfiltration)


>[!example]
>
>Here is **CAPA** running to analyze the *meterpreter.exe* file : 
>
>>[!command]
>>
>>`C:\ capa meterpreter.exe`

>>[!output]
>>
>>FLARE-VM Wed 09/25/2024  9:42:38.81
C:\Users\username\Downloads\windows_meterpreter_reverse_tcp>capa meterpreter.exe
┍━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ md5                    │ 37d3814bd6153253fadd28ec03b25a76                                                   │
│ sha1                   │ 0dd24663747eba990fc9426b809c3c2729d6c27e                                           │
│ sha256                 │ 2bedc6b56c8f75bcdcbc95aebd39f1daed7869166580cfcb2152e6b296349dfd                   │
│ analysis               │ static                                                                             │
│ os                     │ windows                                                                            │
│ format                 │ pe                                                                                 │
│ arch                   │ i386                                                                               │
│ path                   │ C:/Users/username/Downloads/windows_meterpreter_reverse_tcp/meterpreter.exe        │
┕━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙

┍━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ ATT&CK Tactic          │ ATT&CK Technique                                                                   │
┝━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┥
│ DEFENSE EVASION        │ Obfuscated Files or Information T1027                                              │
│                        │ Obfuscated Files or Information::Indicator Removal from Tools T1027.005            │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
│ DISCOVERY              │ System Information Discovery T1082                                                 │
│                        │ System Network Configuration Discovery T1016                                       │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
│ EXECUTION              │ Command and Scripting Interpreter T1059                                            │
│                        │ Shared Modules T1129                                                               │
┕━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙


┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ MBC Objective               │ MBC Behavior                                                                  │
┝━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┥
│ COMMAND AND CONTROL         │ C2 Communication::Receive Data [B0030.002]                                    │
│                             │ C2 Communication::Send Data [B0030.001]                                       │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ COMMUNICATION               │ DNS Communication::Resolve [C0011.001]                                        │
│                             │ HTTP Communication::Read Header [C0002.014]                                   │
│                             │ Interprocess Communication::Read Pipe [C0003.003]                             │
│                             │ Socket Communication::Get Socket Status [C0001.012]                           │
│                             │ Socket Communication::Initialize Winsock Library [C0001.009]                  │
│                             │ Socket Communication::Receive Data [C0001.006]                                │
│                             │ Socket Communication::Send Data [C0001.007]                                   │
│                             │ Socket Communication::Set Socket Config [C0001.001]                           │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ CRYPTOGRAPHY                │ Encrypt Data::RC4 [C0027.009]                                                 │
│                             │ Generate Pseudo-random Sequence::RC4 PRGA [C0021.004]                         │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ DATA                        │ Check String [C0019]                                                          │
│                             │ Compression Library [C0060]                                                   │
│                             │ Encode Data::Base64 [C0026.001]                                               │
│                             │ Encode Data::XOR [C0026.002]                                                  │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ DEFENSE EVASION             │ Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]      │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ DISCOVERY                   │ Code Discovery::Inspect Section Memory Permissions [B0046.002]                │
│                             │ System Information Discovery [E1082]                                          │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ EXECUTION                   │ Command and Scripting Interpreter [E1059]                                     │
│                             │ Install Additional Program [B0023]                                            │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ FILE SYSTEM                 │ Read File [C0051]                                                             │
│                             │ Writes File [C0052]                                                           │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ PROCESS                     │ Allocate Thread Local Storage [C0040]                                         │
│                             │ Create Mutex [C0042]                                                          │
│                             │ Terminate Process [C0018]                                                     │
┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙

┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ Capability                                           │ Namespace                                            │
┝━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┥
│ receive data                                         │ communication                                        │
│ send data                                            │ communication                                        │
│ resolve DNS                                          │ communication/dns                                    │
│ check HTTP status code (2 matches)                   │ communication/http/client                            │
│ read pipe                                            │ communication/named-pipe/read                        │
│ get socket status (2 matches)                        │ communication/socket                                 │
│ initialize Winsock library                           │ communication/socket                                 │
│ set socket configuration (3 matches)                 │ communication/socket                                 │
│ encode data using Base64                             │ data-manipulation/encoding/base64                    │
│ reference Base64 string                              │ data-manipulation/encoding/base64                    │
│ encode data using XOR (3 matches)                    │ data-manipulation/encoding/xor                       │
│ encrypt data using RC4 PRGA                          │ data-manipulation/encryption/rc4                     │
│ contain an embedded PE file                          │ executable/subfile/pe                                │
│ accept command line arguments                        │ host-interaction/cli                                 │
│ interact with driver via IOCTL                       │ host-interaction/driver                              │
│ query environment variable                           │ host-interaction/environment-variable                │
│ read file on Windows                                 │ host-interaction/file-system/read                    │
│ write file on Windows                                │ host-interaction/file-system/write                   │
│ create mutex                                         │ host-interaction/mutex                               │
│ check OS version                                     │ host-interaction/os/version                          │
│ terminate process (8 matches)                        │ host-interaction/process/terminate                   │
│ allocate thread local storage                        │ host-interaction/thread/tls                          │
│ access PEB ldr_data (2 matches)                      │ linking/runtime-linking                              │
│ link function at runtime on Windows (2 matches)      │ linking/runtime-linking                              │
│ resolve function by hash                             │ linking/runtime-linking                              │
│ linked against ZLIB                                  │ linking/static/zlib                                  │
│ inspect section memory permissions                   │ load-code/pe                                         │
│ parse PE header                                      │ load-code/pe                                         │
│ resolve function by parsing PE exports (5 matches)   │ load-code/pe                                         │
┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙



>[!output]
>
>`capa malicious,exe` 
>
>C:\Users\username\Downloads\windows_shell_reverse_tcp>capa malicious.exe
┍━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ md5                    │ d406b2e57a23aba256989b966b64d529                                                   │
│ sha1                   │ 6a182d5b5a46f5eaa63802da25e64b77f07ac38b                                           │
│ sha256                 │ 23f9f5259e77ee7410bd7f45764513175598183959f0229373338c852ab0ae84                   │
│ analysis               │ static                                                                             │
│ os                     │ windows                                                                            │
│ format                 │ pe                                                                                 │
│ arch                   │ i386                                                                               │
│ path                   │ C:/Users/username/Downloads/windows_shell_reverse_tcp/malicious.exe                │
┕━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙

┍━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ ATT&CK Tactic          │ ATT&CK Technique                                                                   │
┝━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┥
│ DEFENSE EVASION        │ Obfuscated Files or Information T1027                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤
│ EXECUTION              │ Shared Modules T1129                                                               │
┕━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙


┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ MBC Objective               │ MBC Behavior                                                                  │
┝━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┥
│ DATA                        │ Check String [C0019]                                                          │
│                             │ Encode Data::Base64 [C0026.001]                                               │
│                             │ Encode Data::XOR [C0026.002]                                                  │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ DEFENSE EVASION             │ Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]      │
├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┤
│ PROCESS                     │ Terminate Process [C0018]                                                     │
┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙

┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑
│ Capability                                           │ Namespace                                            │
┝━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┥
│ reference Base64 string                              │ data-manipulation/encoding/base64                    │
│ encode data using XOR                                │ data-manipulation/encoding/xor                       │
│ contains PDB path                                    │ executable/pe/pdb                                    │
│ terminate process (2 matches)                        │ host-interaction/process/terminate                   │
│ access PEB ldr_data                                  │ linking/runtime-linking                              │
│ resolve function by parsing PE exports (3 matches)   │ load-code/pe                                         │
┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙





